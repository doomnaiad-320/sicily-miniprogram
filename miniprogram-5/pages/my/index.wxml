<view class="my-page">
  <!-- 用户信息 -->
  <view class="user-card">
    <view wx:if="{{isLoggedIn && userInfo}}" class="user-info">
      <t-avatar image="{{userInfo.avatarUrl}}" size="large" />
      <view class="user-detail">
        <view class="nickname">{{userInfo.nickname}}</view>
      </view>
      <t-icon name="setting" size="48rpx" bindtap="goSetting" />
    </view>
    <view wx:else class="login-tip" bindtap="goLogin">
      <t-avatar icon="user" size="large" />
      <view class="login-text">点击登录</view>
    </view>
  </view>

  <!-- 我的发布 -->
  <view class="my-posts" wx:if="{{isLoggedIn}}">
    <view class="section-title">我的发布</view>

    <t-tabs defaultValue="all" bind:change="onTabChange">
      <t-tab-panel label="全部" value="all" />
      <t-tab-panel label="审核中" value="PENDING" />
      <t-tab-panel label="已通过" value="APPROVED" />
      <t-tab-panel label="已拒绝" value="REJECTED" />
    </t-tabs>

    <view class="post-list">
      <view wx:if="{{myPosts.length === 0 && !loading}}" class="empty-tip">
        <t-empty description="暂无发布" />
      </view>

      <view
        wx:for="{{myPosts}}"
        wx:key="id"
        class="post-item"
        data-id="{{item.id}}"
        bindtap="goDetail"
      >
        <image src="{{item.images[0].url}}" mode="aspectFill" class="post-thumb" />
        <view class="post-content">
          <view class="post-desc">{{item.description}}</view>
          <view class="post-footer">
            <text class="post-type {{item.type === 'LOST' ? 'lost' : 'found'}}">
              {{item.type === 'LOST' ? '失物' : '招领'}}
            </text>
            <text class="post-status status-{{item.status}}">
              {{item.status === 'PENDING' ? '审核中' : item.status === 'APPROVED' ? '已通过' : item.status === 'REJECTED' ? '已拒绝' : '已下架'}}
            </text>
          </view>
          <view wx:if="{{item.status === 'REJECTED' && item.rejectReason}}" class="reject-reason">
            拒绝原因：{{item.rejectReason}}
          </view>
        </view>
      </view>

      <view wx:if="{{loading}}" class="loading-tip">
        <t-loading theme="circular" size="40rpx" />
      </view>
    </view>
  </view>
</view>
