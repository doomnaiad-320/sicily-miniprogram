<view class="home-container">
  <view class="nav-tabs">
    <view 
      class="nav-tab {{activeTab === 'all' ? 'active' : ''}}" 
      data-value="all" 
      bindtap="onNavTabTap"
    >
      全部
    </view>
    <view 
      class="nav-tab {{activeTab === 'LOST' ? 'active' : ''}}" 
      data-value="LOST" 
      bindtap="onNavTabTap"
    >
      失物
    </view>
    <view 
      class="nav-tab {{activeTab === 'FOUND' ? 'active' : ''}}" 
      data-value="FOUND" 
      bindtap="onNavTabTap"
    >
      招领
    </view>
  </view>

  <t-pull-down-refresh
    value="{{enable}}"
    bind:refresh="onRefresh"
    loadingTexts="{{['下拉刷新', '松手刷新', '正在刷新', '刷新完成']}}"
  >
    <view class="waterfall-container">
      <view wx:if="{{leftColumn.length === 0 && rightColumn.length === 0 && !loading}}" class="empty-tip">
        <t-empty description="暂无数据" />
      </view>

      <view class="waterfall-column left-column">
        <view
          wx:for="{{leftColumn}}"
          wx:key="id"
          class="waterfall-card {{item.bizStatus === 'CLOSED' ? 'closed' : ''}}"
          data-id="{{item.id}}"
          bindtap="goDetail"
        >
          <view class="card-image">
            <image src="{{item.images[0].url || '/assets/default-image.png'}}" mode="widthFix" bindload="onImageLoad" data-id="{{item.id}}" />
            <view class="card-type {{item.type === 'LOST' ? 'lost' : 'found'}}">
              {{item.type === 'LOST' ? '失物' : '招领'}}
            </view>
            <view wx:if="{{item.bizStatus === 'CLOSED'}}" class="card-biz-status">
              {{item.bizStatusText}}
            </view>
          </view>
          <view class="card-content">
            <view class="card-desc">{{item.description}}</view>
            <view class="card-meta">
              <text class="card-category">{{item.category.name}}</text>
            </view>
            <view class="card-location" wx:if="{{item.locationText}}">
              <t-icon name="location" size="28rpx" />
              <text>{{item.locationText}}</text>
            </view>
            <view class="card-time">
              <t-icon name="time" size="24rpx" />
              <text>{{item.createdAtText}}</text>
            </view>
          </view>
        </view>
      </view>

      <view class="waterfall-column right-column">
        <view
          wx:for="{{rightColumn}}"
          wx:key="id"
          class="waterfall-card {{item.bizStatus === 'CLOSED' ? 'closed' : ''}}"
          data-id="{{item.id}}"
          bindtap="goDetail"
        >
          <view class="card-image">
            <image src="{{item.images[0].url || '/assets/default-image.png'}}" mode="widthFix" bindload="onImageLoad" data-id="{{item.id}}" />
            <view class="card-type {{item.type === 'LOST' ? 'lost' : 'found'}}">
              {{item.type === 'LOST' ? '失物' : '招领'}}
            </view>
            <view wx:if="{{item.bizStatus === 'CLOSED'}}" class="card-biz-status">
              {{item.bizStatusText}}
            </view>
          </view>
          <view class="card-content">
            <view class="card-desc">{{item.description}}</view>
            <view class="card-meta">
              <text class="card-category">{{item.category.name}}</text>
            </view>
            <view class="card-location" wx:if="{{item.locationText}}">
              <t-icon name="location" size="28rpx" />
              <text>{{item.locationText}}</text>
            </view>
            <view class="card-time">
              <t-icon name="time" size="24rpx" />
              <text>{{item.createdAtText}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view wx:if="{{loading}}" class="loading-tip">
      <t-loading theme="circular" size="40rpx" />
      <text>加载中...</text>
    </view>
  </t-pull-down-refresh>
</view>

<view class="fab-button" bindtap="goRelease">
  <t-icon name="add" size="48rpx" color="#fff" />
</view>
<t-message id="t-message" />
